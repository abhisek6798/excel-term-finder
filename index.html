<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Search</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better aesthetics and responsiveness */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to start to allow scrolling */
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            margin-top: 20px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        .input-field {
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
        }
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary {
            background-color: #4f46e5; /* Indigo 600 */
            color: #ffffff;
            border: none;
        }
        .btn-primary:hover {
            background-color: #4338ca; /* Indigo 700 */
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #6b7280; /* Gray 500 */
            color: #ffffff;
            border: none;
        }
        .btn-secondary:hover {
            background-color: #4b5563; /* Gray 600 */
            transform: translateY(-2px);
        }
        .results-container {
            margin-top: 25px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow-x: auto; /* Enable horizontal scrolling for tables */
            max-height: 500px; /* Limit height for scrollable results */
            overflow-y: auto;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .results-table th, .results-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap; /* Prevent text wrapping in cells */
        }
        .results-table th {
            background-color: #f9fafb; /* Light gray for header */
            font-weight: 600;
            color: #374151;
            position: sticky; /* Sticky header */
            top: 0;
            z-index: 10;
        }
        .results-table tr:last-child td {
            border-bottom: none;
        }
        .results-table tbody tr:hover {
            background-color: #f3f4f6; /* Hover effect for rows */
        }
        .message-box {
            background-color: #fefcbf; /* Yellow 100 */
            color: #92400e; /* Yellow 800 */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none; /* Hidden by default */
            align-items: center;
            gap: 10px;
        }
        .message-box.show {
            display: flex;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }
        .loading-spinner.show {
            display: block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (min-width: 640px) {
            .input-group {
                flex-direction: row;
                align-items: flex-end;
            }
            .input-field {
                flex-grow: 1;
            }
            .btn-group {
                display: flex;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Product Rate Chart Search</h1>

        <div id="messageBox" class="message-box">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span id="messageText"></span>
        </div>

        <div class="input-group">
            <div class="flex-1">
                <label for="keyword" class="block text-sm font-medium text-gray-700 mb-1">Enter Product Keyword</label>
                <input type="text" id="keyword" placeholder="e.g., 'Shampoo', 'Soap'" class="input-field">
            </div>
            <div class="btn-group">
                <button id="searchButton" class="btn btn-primary">
                    <div id="loadingSpinner" class="loading-spinner mr-2"></div>
                    Search
                </button>
                <button id="clearButton" class="btn btn-secondary">Clear Results</button>
            </div>
        </div>

        <div id="resultsContainer" class="results-container hidden">
            <table id="resultsTable" class="results-table">
                <thead>
                    <tr id="tableHeader">
                        <!-- Table headers will be inserted here by JS -->
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Search results will be inserted here by JS -->
                </tbody>
            </table>
        </div>
        <p id="noResultsMessage" class="text-center text-gray-600 mt-4 hidden">No results found for your search.</p>
    </div>

    <script>
        // --- IMPORTANT: REPLACE WITH YOUR GOOGLE SHEET DETAILS ---
        // 1. Get your SPREADSHEET_ID from the Google Sheet URL:
        //    Example URL: https://docs.google.com/spreadsheets/d/1A2B3C4D5E6F7G8H9I0J/edit#gid=0
        //    SPREADSHEET_ID would be: 1A2B3C4D5E6F7G8H9I0J
        const SPREADSHEET_ID = '1NXd9nH41VBDTczdyHXNZnuvEpam-YxhU0UdGVIc7HEU'; // <--- REPLACE THIS

        // 2. Get your SHEET_NAME (usually the tab name at the bottom of the sheet)
        //    If your sheet tab is named "Products", then SHEET_NAME = 'Products'
        const SHEET_NAME = 'PriceList'; // <--- REPLACE THIS (e.g., 'Products', 'Rate Chart')

        // Construct the Google Sheets CSV export URL
        const GOOGLE_SHEET_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
        // --------------------------------------------------------

        // Get references to DOM elements
        const keywordInput = document.getElementById('keyword');
        const searchButton = document.getElementById('searchButton');
        const clearButton = document.getElementById('clearButton');
        const resultsContainer = document.getElementById('resultsContainer');
        const tableHeader = document.getElementById('tableHeader');
        const tableBody = document.getElementById('tableBody');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const noResultsMessage = document.getElementById('noResultsMessage');

        let excelData = []; // To store parsed Google Sheet data
        let headerRow = []; // To store the header row for table display

        /**
         * Displays a message box with the given text and type.
         * @param {string} message - The message to display.
         * @param {string} type - 'success', 'error', 'warning'. Determines styling.
         */
        function showMessage(message, type) {
            messageText.textContent = message;
            messageBox.className = 'message-box show'; // Reset classes
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'warning') {
                messageBox.classList.add('bg-yellow-100', 'text-yellow-800');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800');
            }
            // Hide message after 5 seconds
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 5000);
        }

        /**
         * Hides the message box.
         */
        function hideMessage() {
            messageBox.classList.remove('show');
        }

        /**
         * Shows or hides the loading spinner.
         * @param {boolean} show - True to show, false to hide.
         */
        function toggleLoadingSpinner(show) {
            if (show) {
                loadingSpinner.classList.add('show');
                searchButton.disabled = true;
                searchButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                loadingSpinner.classList.remove('show');
                searchButton.disabled = false;
                searchButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        /**
         * Fetches data from the Google Sheet URL and parses it.
         */
        async function fetchGoogleSheetData() {
            toggleLoadingSpinner(true);
            hideMessage();
            clearResults(); // Clear previous results

            if (SPREADSHEET_ID === 'YOUR_GOOGLE_SHEET_ID_HERE') {
                showMessage('Please update the SPREADSHEET_ID and SHEET_NAME in the code to your actual Google Sheet details.', 'error');
                toggleLoadingSpinner(false);
                return;
            }

            try {
                const response = await fetch(GOOGLE_SHEET_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}. Ensure the sheet is published to the web.`);
                }
                const csvText = await response.text();

                // Parse CSV data
                const rows = csvText.split('\n').map(row => {
                    // Simple CSV parsing for comma-separated values,
                    // handles quoted fields with commas inside.
                    const regex = /(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|([^,]*))/g;
                    let match;
                    const result = [];
                    while ((match = regex.exec(row)) !== null) {
                        // If a quoted group is matched, use it; otherwise, use the unquoted group
                        result.push(match[1] !== undefined ? match[1].replace(/\"\"/g, '\"') : match[2]);
                    }
                    return result;
                }).filter(row => row.length > 0 && row.some(cell => cell.trim() !== '')); // Filter out empty rows

                if (rows.length === 0) {
                    showMessage('The Google Sheet is empty or could not be parsed.', 'warning');
                    excelData = [];
                    headerRow = [];
                    return;
                }

                headerRow = rows[0];
                excelData = rows.slice(1);

                showMessage(`Data loaded successfully from Google Sheet "${SHEET_NAME}".`, 'success');

            } catch (error) {
                console.error('Error fetching or parsing Google Sheet:', error);
                showMessage(`Failed to load data from Google Sheet. Error: ${error.message}. Please check the ID/Name and sharing settings.`, 'error');
                excelData = [];
                headerRow = [];
            } finally {
                toggleLoadingSpinner(false);
            }
        }

        /**
         * Performs the search based on the keyword and displays results.
         */
        searchButton.addEventListener('click', () => {
            const keyword = keywordInput.value.trim();

            if (excelData.length === 0) {
                showMessage('Data not loaded. Please ensure the Google Sheet ID/Name is correct and it is published to the web.', 'warning');
                return;
            }

            if (!keyword) {
                showMessage('Please enter a keyword to search.', 'warning');
                return;
            }

            hideMessage();
            toggleLoadingSpinner(true);
            clearResults(); // Clear previous results

            const lowerCaseKeyword = keyword.toLowerCase();
            const matchingRows = [];

            // Iterate through each data row
            excelData.forEach((row) => {
                let rowMatches = false;
                // Ensure row is an array before iterating
                if (Array.isArray(row)) {
                    row.forEach(cell => {
                        if (cell !== null && cell !== undefined) {
                            // Convert cell content to string and check for keyword
                            if (String(cell).toLowerCase().includes(lowerCaseKeyword)) {
                                rowMatches = true;
                                return; // Exit inner loop if match found in this row
                            }
                        }
                    });
                }
                if (rowMatches) {
                    matchingRows.push(row);
                }
            });

            if (matchingRows.length > 0) {
                displayResults(matchingRows);
                showMessage(`Found ${matchingRows.length} matching rows.`, 'success');
            } else {
                noResultsMessage.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
                showMessage('No matching rows found for the keyword.', 'warning');
            }
            toggleLoadingSpinner(false);
        });

        /**
         * Clears the search results and resets the display.
         */
        clearButton.addEventListener('click', () => {
            clearResults();
            keywordInput.value = '';
            hideMessage();
            showMessage('Results cleared. Ready for a new search.', 'success');
        });

        /**
         * Clears the table body and hides the results container.
         */
        function clearResults() {
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            resultsContainer.classList.add('hidden');
            noResultsMessage.classList.add('hidden');
        }

        /**
         * Displays the search results in a table.
         * @param {Array<Array<any>>} results - An array of arrays, where each inner array is a matching row.
         */
        function displayResults(results) {
            // Clear existing headers and body
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';

            if (headerRow.length === 0 && results.length > 0) {
                // Fallback: If headerRow wasn't explicitly set, infer from first result.
                headerRow = Array.from({ length: results[0].length }, (_, i) => `Column ${i + 1}`);
            }

            // Create table headers
            headerRow.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                tableHeader.appendChild(th);
            });

            // Populate table body with results
            results.forEach(rowData => {
                const tr = document.createElement('tr');
                // Ensure rowData is an array before iterating
                if (Array.isArray(rowData)) {
                    rowData.forEach(cellData => {
                        const td = document.createElement('td');
                        td.textContent = cellData !== null && cellData !== undefined ? String(cellData) : '';
                        tr.appendChild(td);
                    });
                }
                tableBody.appendChild(tr);
            });

            resultsContainer.classList.remove('hidden');
            noResultsMessage.classList.add('hidden');
        }

        // Initial state: clear results and hide messages
        clearResults();
        hideMessage();
        // Fetch data from Google Sheet when the page loads
        fetchGoogleSheetData();
    </script>
</body>
</html>
